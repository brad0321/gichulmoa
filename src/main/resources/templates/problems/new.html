<!-- src/main/resources/templates/problems/new.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title>문제 등록 | 공인중개사 기출모아</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <style>
        :root{
            --color-main:#2F4858; --color-sub:#4F7CAC; --color-point:#F5CD90;
            --text-main:#2C3E3F; --text-sub:#7A746E; --bg:#F4F3F1; --white:#ffffff;
            --radius:18px; --shadow:0 10px 24px rgba(47,72,88,.15);
        }
        body{
            background:var(--bg); color:var(--text-main);
            font-family:'Noto Sans KR',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
            letter-spacing:.1px;
        }
        .page-wrap{ max-width: 960px; margin: clamp(24px,5vh,72px) auto; padding: 0 14px; }

        .brand{ display:flex; align-items:center; gap:12px; margin-bottom:14px; }
        .brand img{ height:36px; }
        .brand .title{ font-weight:900; font-size:18px; }
        .muted{ color:var(--text-sub); }

        .card-box{
            border:0; background:var(--white); border-radius:var(--radius);
            box-shadow:var(--shadow); padding:22px;
        }
        .section-title{
            color:var(--color-main); font-weight:800;
            font-size:18px; margin-bottom:12px;
        }

        .form-label{ font-weight:700; }
        .form-control, .form-select{
            border-radius:12px; border:1px solid #d9d6d1; padding:10px 12px;
        }
        .form-control:focus, .form-select:focus{
            border-color:var(--color-sub); box-shadow:0 0 0 .2rem rgba(79,124,172,.15);
        }
        .help{ font-size:12px; color:var(--text-sub); margin-top:6px; }

        .img-wrap{
            border:1px solid #e6e3df; background:#fff;
            border-radius:12px; padding:10px; display:inline-block;
        }

        .btn-uniform{
            padding:6px 10px; min-height:36px;
            border-radius:8px; font-weight:600; font-size:.9rem;
        }
        .btn-main{ background:var(--color-main); border-color:var(--color-main); color:#fff; }
        .btn-main:hover{ background:#243946; border-color:#243946; }
        .btn-sub{ background:var(--color-sub); border-color:var(--color-sub); color:#fff; }
        .btn-sub:hover{ background:#426d96; border-color:#426d96; }
        .btn-ghost{ border:1px solid #c9c4bd; background:transparent; color: var(--text-main); }
        .btn-ghost:hover{ background:#f0efec; }

        .toolbar{ margin-bottom:6px; display:flex; gap:6px; flex-wrap:wrap; }
        .toolbar button{ flex:0 0 auto; }

        .preview-pill{
            background:#fff7e8; border:1px dashed #e8c27a; color:#6a5a2d;
            border-radius:10px; padding:8px 10px; font-weight:700;
            font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
        }
        .grid-compact .col-md-2, .grid-compact .col-md-3 { margin-bottom: .5rem; }
    </style>
</head>
<body>

<main class="page-wrap">
    <!-- 헤더 -->
    <div class="brand">
        <img src="/img/brandLogo.png" alt="로고">
        <div class="title">공인중개사 기출모아</div>
        <div class="muted">문제 등록</div>
    </div>

    <!-- 카드 -->
    <section class="card-box">
        <form th:action="@{/problems/new}" method="post" enctype="multipart/form-data" id="createForm" novalidate>
            <input type="hidden" th:if="${_csrf}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

            <!-- 분류: 과목/회차/단원 -->
            <h2 class="section-title">분류 정보</h2>
            <div class="row g-3">
                <div class="col-md-4">
                    <label for="subject-select" class="form-label">과목</label>
                    <select class="form-select" name="subjectId" id="subject-select" required>
                        <option value="">과목 선택</option>
                        <option th:each="subject : ${subjects}"
                                th:value="${subject.id}"
                                th:text="${subject.name}"></option>
                    </select>
                    <div class="help">과목을 선택하면 관련 회차/단원을 불러옵니다.</div>
                </div>
                <div class="col-md-4">
                    <label for="round-select" class="form-label">회차</label>
                    <select class="form-select" name="roundId" id="round-select" required>
                        <option value="">회차 선택</option>
                    </select>
                    <div class="help">예: 35회, 34회 … (옵션 텍스트에서 회차 숫자를 추출해 미리보기 생성)</div>
                </div>
                <div class="col-md-4">
                    <label for="unit-select" class="form-label">단원</label>
                    <select class="form-select" name="unitId" id="unit-select" required>
                        <option value="">단원 선택</option>
                    </select>
                </div>
            </div>

            <!-- 고유번호(구성요소) -->
            <hr class="my-4">
            <h2 class="section-title">고유번호</h2>

            <div class="row g-3 grid-compact">
                <!-- 회차 기준: RR_PP -->
                <div class="col-md-3">
                    <label class="form-label" for="roundProblemNo">회차 내 번호 (1~40)</label>
                    <input type="number" class="form-control" id="roundProblemNo" name="roundProblemNo"
                           min="1" max="40" placeholder="예: 1" required>
                    <div class="help">문항 번호. 예: 1 → 01</div>
                </div>
                <div class="col-md-3">
                    <label class="form-label d-flex align-items-center justify-content-between">
                        회차 코드 미리보기
                        <span class="badge text-bg-light">RR_PP</span>
                    </label>
                    <div class="preview-pill" id="roundCodePreview" aria-live="polite">--</div>
                    <div class="help">저장 시 DB에서 자동 생성됩니다.</div>
                </div>

                <!-- 과목·단원 기준: SS_UUU_PP -->
                <div class="col-md-2">
                    <label class="form-label" for="subjectCode">과목 코드 (SS)</label>
                    <input type="text" class="form-control" id="subjectCode" name="subjectCode"
                           inputmode="numeric" maxlength="2" placeholder="예: 01"
                           pattern="^\d{2}$" required>
                    <div class="help">2자리 숫자. 예: 01=민법</div>
                </div>
                <div class="col-md-2">
                    <label class="form-label" for="unitSeqCode">단원 코드 (UUU)</label>
                    <input type="text" class="form-control" id="unitSeqCode" name="unitSeqCode"
                           inputmode="numeric" maxlength="3" placeholder="예: 001"
                           pattern="^\d{3}$" required>
                    <div class="help">3자리 숫자. 예: 001=법률사실</div>
                </div>
                <div class="col-md-2">
                    <label class="form-label" for="unitProblemNo">단원 내 순번 (1~99)</label>
                    <input type="number" class="form-control" id="unitProblemNo" name="unitProblemNo"
                           min="1" max="99" placeholder="예: 1" required>
                    <div class="help">PP로 2자리 패딩. 예: 1 → 01</div>
                </div>
                <div class="col-md-3">
                    <label class="form-label d-flex align-items-center justify-content-between">
                        단원 코드 미리보기
                        <span class="badge text-bg-light">SS_UUU_PP</span>
                    </label>
                    <div class="preview-pill" id="unitCodePreview" aria-live="polite">--</div>
                    <div class="help">저장 시 DB에서 자동 생성됩니다.</div>
                </div>
            </div>

            <hr class="my-4">

            <!-- 질문 (HTML 지원) -->
            <div class="mb-3">
                <label for="title" class="form-label">문제 질문</label>

                <!-- 질문용 HTML 툴바 -->
                <div class="toolbar" data-target="title">
                    <button type="button" class="btn btn-ghost btn-uniform insert-tag" data-tag="<p></p>">&lt;p&gt;&lt;/p&gt;</button>
                    <button type="button" class="btn btn-ghost btn-uniform insert-tag" data-tag="<p style='margin-left: 20px;'></p>">&lt;p style='margin-left: 20px;'&gt;&lt;/p&gt;</button>
                    <button type="button" class="btn btn-ghost btn-uniform insert-tag" data-tag="<br>">&lt;br&gt;</button>
                    <button type="button" class="btn btn-ghost btn-uniform insert-tag" data-tag="<strong></strong>">&lt;strong&gt;&lt;/strong&gt;</button>
                    <button type="button" class="btn btn-ghost btn-uniform insert-tag" data-tag="<u></u>">&lt;u&gt;&lt;/u&gt;</button>
                    <button type="button" class="btn btn-ghost btn-uniform insert-tag" data-tag="<span style='color:red;'></span>">&lt;span style='color:red;'&gt;&lt;/span&gt;</button>
                </div>

                <textarea id="title" name="title" class="form-control" rows="2"
                          placeholder="문제 질문 입력" required></textarea>
                <div class="help">질문도 HTML 태그 사용 가능 (굵게, 밑줄, 줄바꿈 등)</div>
            </div>

            <!-- 지문 -->
            <div class="mb-3">
                <label for="viewContent" class="form-label">문제 지문</label>
                <div class="toolbar" data-target="viewContent">
                    <button type="button" class="btn btn-ghost btn-uniform insert-tag" data-tag="<p></p>">&lt;p&gt;&lt;/p&gt;</button>
                    <button type="button" class="btn btn-ghost btn-uniform insert-tag" data-tag="<p style='margin-left: 20px;'></p>">&lt;p style='margin-left: 20px;'&gt;&lt;/p&gt;</button>
                    <button type="button" class="btn btn-ghost btn-uniform insert-tag" data-tag="<br>">&lt;br&gt;</button>
                    <button type="button" class="btn btn-ghost btn-uniform insert-tag" data-tag="<strong></strong>">&lt;strong&gt;&lt;/strong&gt;</button>
                    <button type="button" class="btn btn-ghost btn-uniform insert-tag" data-tag="<u></u>">&lt;u&gt;&lt;/u&gt;</button>
                    <button type="button" class="btn btn-ghost btn-uniform insert-tag" data-tag="<span style='color:red;'></span>">&lt;span style='color:red;'&gt;&lt;/span&gt;</button>
                </div>
                <textarea id="viewContent" name="viewContent" class="form-control" rows="5"></textarea>
                <div class="help">HTML 입력 가능. 툴바 버튼으로 태그를 빠르게 추가할 수 있습니다.</div>
            </div>

            <!-- 이미지 업로드 -->
            <div class="mb-3">
                <label class="form-label">이미지 업로드</label>
                <input type="file" id="imageFile" name="imageFile" class="form-control" accept="image/*">
                <div class="img-wrap mt-2" id="previewWrap" style="display:none;">
                    <img id="previewImg" class="img-fluid" style="max-height:160px;" alt="미리보기">
                </div>
            </div>

            <hr class="my-4">

            <!-- 보기 -->
            <h2 class="section-title">선택 문항</h2>
            <div>
                <!-- 보기 1 -->
                <div class="mb-3">
                    <label class="form-label" for="choice1">보기 1</label>
                    <div class="toolbar" data-target="choice1">
                        <button type="button" class="btn btn-ghost btn-uniform insert-tag" data-tag="<p></p>">&lt;p&gt;&lt;/p&gt;</button>
                        <button type="button" class="btn btn-ghost btn-uniform insert-tag" data-tag="<p style='margin-left: 20px;'></p>">&lt;p style='margin-left: 20px;'&gt;&lt;/p&gt;</button>
                        <button type="button" class="btn btn-ghost btn-uniform insert-tag" data-tag="<br>">&lt;br&gt;</button>
                        <button type="button" class="btn btn-ghost btn-uniform insert-tag" data-tag="<strong></strong>">&lt;strong&gt;&lt;/strong&gt;</button>
                        <button type="button" class="btn btn-ghost btn-uniform insert-tag" data-tag="<u></u>">&lt;u&gt;&lt;/u&gt;</button>
                        <button type="button" class="btn btn-ghost btn-uniform insert-tag" data-tag="<span style='color:red;'></span>">&lt;span style='color:red;'&gt;&lt;/span&gt;</button>
                    </div>
                    <textarea id="choice1" name="choice1" class="form-control" rows="2"
                              placeholder="보기 1 내용을 입력하세요 (HTML 태그 사용 가능)"></textarea>
                </div>

                <!-- 보기 2 -->
                <div class="mb-3">
                    <label class="form-label" for="choice2">보기 2</label>
                    <div class="toolbar" data-target="choice2">
                        <button type="button" class="btn btn-ghost btn-uniform insert-tag" data-tag="<p></p>">&lt;p&gt;&lt;/p&gt;</button>
                        <button type="button" class="btn btn-ghost btn-uniform insert-tag" data-tag="<p style='margin-left: 20px;'></p>">&lt;p style='margin-left: 20px;'&gt;&lt;/p&gt;</button>
                        <button type="button" class="btn btn-ghost btn-uniform insert-tag" data-tag="<br>">&lt;br&gt;</button>
                        <button type="button" class="btn btn-ghost btn-uniform insert-tag" data-tag="<strong></strong>">&lt;strong&gt;&lt;/strong&gt;</button>
                        <button type="button" class="btn btn-ghost btn-uniform insert-tag" data-tag="<u></u>">&lt;u&gt;&lt;/u&gt;</button>
                        <button type="button" class="btn btn-ghost btn-uniform insert-tag" data-tag="<span style='color:red;'></span>">&lt;span style='color:red;'&gt;&lt;/span&gt;</button>
                    </div>
                    <textarea id="choice2" name="choice2" class="form-control" rows="2"
                              placeholder="보기 2 내용을 입력하세요 (HTML 태그 사용 가능)"></textarea>
                </div>

                <!-- 보기 3 -->
                <div class="mb-3">
                    <label class="form-label" for="choice3">보기 3</label>
                    <div class="toolbar" data-target="choice3">
                        <button type="button" class="btn btn-ghost btn-uniform insert-tag" data-tag="<p></p>">&lt;p&gt;&lt;/p&gt;</button>
                        <button type="button" class="btn btn-ghost btn-uniform insert-tag" data-tag="<p style='margin-left: 20px;'></p>">&lt;p style='margin-left: 20px;'&gt;&lt;/p&gt;</button>
                        <button type="button" class="btn btn-ghost btn-uniform insert-tag" data-tag="<br>">&lt;br&gt;</button>
                        <button type="button" class="btn btn-ghost btn-uniform insert-tag" data-tag="<strong></strong>">&lt;strong&gt;&lt;/strong&gt;</button>
                        <button type="button" class="btn btn-ghost btn-uniform insert-tag" data-tag="<u></u>">&lt;u&gt;&lt;/u&gt;</button>
                        <button type="button" class="btn btn-ghost btn-uniform insert-tag" data-tag="<span style='color:red;'></span>">&lt;span style='color:red;'&gt;&lt;/span&gt;</button>
                    </div>
                    <textarea id="choice3" name="choice3" class="form-control" rows="2"
                              placeholder="보기 3 내용을 입력하세요 (HTML 태그 사용 가능)"></textarea>
                </div>

                <!-- 보기 4 -->
                <div class="mb-3">
                    <label class="form-label" for="choice4">보기 4</label>
                    <div class="toolbar" data-target="choice4">
                        <button type="button" class="btn btn-ghost btn-uniform insert-tag" data-tag="<p></p>">&lt;p&gt;&lt;/p&gt;</button>
                        <button type="button" class="btn btn-ghost btn-uniform insert-tag" data-tag="<p style='margin-left: 20px;'></p>">&lt;p style='margin-left: 20px;'&gt;&lt;/p&gt;</button>
                        <button type="button" class="btn btn-ghost btn-uniform insert-tag" data-tag="<br>">&lt;br&gt;</button>
                        <button type="button" class="btn btn-ghost btn-uniform insert-tag" data-tag="<strong></strong>">&lt;strong&gt;&lt;/strong&gt;</button>
                        <button type="button" class="btn btn-ghost btn-uniform insert-tag" data-tag="<u></u>">&lt;u&gt;&lt;/u&gt;</button>
                        <button type="button" class="btn btn-ghost btn-uniform insert-tag" data-tag="<span style='color:red;'></span>">&lt;span style='color:red;'&gt;&lt;/span&gt;</button>
                    </div>
                    <textarea id="choice4" name="choice4" class="form-control" rows="2"
                              placeholder="보기 4 내용을 입력하세요 (HTML 태그 사용 가능)"></textarea>
                </div>

                <!-- 보기 5 -->
                <div class="mb-3">
                    <label class="form-label" for="choice5">보기 5</label>
                    <div class="toolbar" data-target="choice5">
                        <button type="button" class="btn btn-ghost btn-uniform insert-tag" data-tag="<p></p>">&lt;p&gt;&lt;/p&gt;</button>
                        <button type="button" class="btn btn-ghost btn-uniform insert-tag" data-tag="<p style='margin-left: 20px;'></p>">&lt;p style='margin-left: 20px;'&gt;&lt;/p&gt;</button>
                        <button type="button" class="btn btn-ghost btn-uniform insert-tag" data-tag="<br>">&lt;br&gt;</button>
                        <button type="button" class="btn btn-ghost btn-uniform insert-tag" data-tag="<strong></strong>">&lt;strong&gt;&lt;/strong&gt;</button>
                        <button type="button" class="btn btn-ghost btn-uniform insert-tag" data-tag="<u></u>">&lt;u&gt;&lt;/u&gt;</button>
                        <button type="button" class="btn btn-ghost btn-uniform insert-tag" data-tag="<span style='color:red;'></span>">&lt;span style='color:red;'&gt;&lt;/span&gt;</button>
                    </div>
                    <textarea id="choice5" name="choice5" class="form-control" rows="2"
                              placeholder="보기 5 내용을 입력하세요 (HTML 태그 사용 가능)"></textarea>
                </div>

                <!-- 정답 선택 -->
                <div class="col-md-12">
                    <label for="answer" class="form-label">정답</label>
                    <select id="answer" class="form-select" name="answer" required>
                        <option value="">정답 선택</option>
                        <option value="1">1번</option>
                        <option value="2">2번</option>
                        <option value="3">3번</option>
                        <option value="4">4번</option>
                        <option value="5">5번</option>
                    </select>
                </div>
            </div>

            <hr class="my-4">

            <div class="d-flex flex-wrap gap-2 justify-content-end mt-4">
                <button type="button" th:onclick="|location.href='@{/problems}'|" class="btn btn-ghost btn-uniform">목록</button>
                <button type="button" th:onclick="|location.href='@{/dashboard}'|" class="btn btn-sub btn-uniform">대시보드</button>
                <button type="submit" class="btn btn-main btn-uniform" id="submitBtn">등록하기</button>
            </div>
        </form>
    </section>

    <p class="text-center mt-3 muted" style="font-size:12px">© 공인중개사 기출모아</p>
</main>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- 페이지 스크립트 -->
<script th:inline="javascript">
    const $  = (s, p=document) => p.querySelector(s);

    // HTML 태그 툴바 (질문 + 지문 공통)
    (function(){
        function setupToolbar(toolbar){
            const targetId = toolbar.getAttribute('data-target');
            const textarea = document.getElementById(targetId);
            if (!textarea) return;

            const buttons = toolbar.querySelectorAll('.insert-tag');

            function insertAtCursor(tag){
                const start = textarea.selectionStart ?? textarea.value.length;
                const end   = textarea.selectionEnd ?? textarea.value.length;
                const text  = textarea.value ?? '';

                textarea.value = text.substring(0, start) + tag + text.substring(end);

                if(tag.includes("</")){
                    const openTagLen = tag.indexOf("</");
                    textarea.selectionStart = textarea.selectionEnd = start + openTagLen;
                }else{
                    textarea.selectionStart = textarea.selectionEnd = start + tag.length;
                }
                textarea.focus();
            }

            buttons.forEach(btn=>{
                btn.addEventListener('click', ()=> insertAtCursor(btn.getAttribute('data-tag')));
            });
        }

        document.querySelectorAll('.toolbar[data-target]').forEach(setupToolbar);
    })();

    // 이미지 미리보기
    (function(){
        const input = $('#imageFile'), wrap  = $('#previewWrap'), img   = $('#previewImg');
        if (input) {
            input.addEventListener('change', e => {
                const file = e.target.files && e.target.files[0];
                if (!file) { wrap.style.display = 'none'; return; }
                const reader = new FileReader();
                reader.onload = ev => { img.src = ev.target.result; wrap.style.display = 'inline-block'; };
                reader.readAsDataURL(file);
            });
        }
    })();

    // 분류: 과목 → 회차 & 단원
    (function(){
        const subj  = $('#subject-select');
        const round = $('#round-select');
        const unit  = $('#unit-select');

        function resetSelect(sel, label){
            sel.innerHTML = '<option value="">' + label + ' 선택</option>';
            sel.disabled = false;
        }

        async function loadRoundsAndUnits(subjectId){
            resetSelect(round, '회차');
            resetSelect(unit, '단원');
            if (!subjectId) return;

            try{
                const res = await axios.get('/problems/api/rounds', { params: { subjectId }});
                (res.data || []).forEach(it=>{
                    const opt = document.createElement('option');
                    opt.value = it.id;
                    opt.textContent = it.name; // 예: "35회"
                    round.appendChild(opt);
                });
            }catch(e){ resetSelect(round, '회차'); }

            try{
                const res2 = await axios.get('/problems/api/units', { params: { subjectId }});
                (res2.data || []).forEach(it=>{
                    const opt = document.createElement('option');
                    opt.value = it.id;
                    opt.textContent = it.name;
                    unit.appendChild(opt);
                });
            }catch(e){ resetSelect(unit, '단원'); }
        }

        subj && subj.addEventListener('change', ()=> loadRoundsAndUnits(subj.value));

        // 페이지 로딩 시 과목 선택값이 있으면 자동 로딩
        if(subj && subj.value){
            loadRoundsAndUnits(subj.value);
        }
    })();

    // ===== 고유번호 미리보기 로직 =====
    (function(){
        const roundSel = $('#round-select');
        const roundNo  = $('#roundProblemNo');
        const roundPrev = $('#roundCodePreview');

        const subjectCode = $('#subjectCode');
        const unitSeqCode = $('#unitSeqCode');
        const unitProbNo  = $('#unitProblemNo');
        const unitPrev    = $('#unitCodePreview');

        function pad2(n){
            n = parseInt(n,10);
            if(isNaN(n)) return '';
            return n < 10 ? '0'+n : String(n);
        }
        function pad3(s){
            s = String(s ?? '').replace(/\D/g,'');
            if(!s) return '';
            return s.padStart(3,'0').slice(-3);
        }
        function onlyDigits(s,len){
            s = String(s ?? '').replace(/\D/g,'');
            if(!s) return '';
            return len ? s.slice(0,len) : s;
        }

        function extractRoundNumberFromOption(){
            const opt = roundSel && roundSel.options[roundSel.selectedIndex];
            if(!opt) return '';
            const m = String(opt.textContent || '').match(/(\d{1,3})/);
            return m ? m[1] : '';
        }

        function renderRoundCode(){
            const RR = extractRoundNumberFromOption();
            const PP = pad2(roundNo.value);
            if(RR && PP){ roundPrev.textContent = `${RR}_${PP}`; }
            else { roundPrev.textContent = '--'; }
        }

        function renderUnitCode(){
            const SS  = onlyDigits(subjectCode.value,2).padStart(2,'0').slice(-2);
            const UUU = pad3(unitSeqCode.value);
            const PP  = pad2(unitProbNo.value);
            if(SS && UUU && PP){ unitPrev.textContent = `${SS}_${UUU}_${PP}`; }
            else { unitPrev.textContent = '--'; }
        }

        roundSel && roundSel.addEventListener('change', renderRoundCode);
        roundNo  && roundNo .addEventListener('input', renderRoundCode);

        subjectCode && subjectCode.addEventListener('input', (e)=>{
            e.target.value = onlyDigits(e.target.value,2);
            renderUnitCode();
        });
        unitSeqCode && unitSeqCode.addEventListener('input', (e)=>{
            e.target.value = onlyDigits(e.target.value,3);
            renderUnitCode();
        });
        unitProbNo && unitProbNo.addEventListener('input', renderUnitCode);

        // 초기 렌더
        renderRoundCode();
        renderUnitCode();
    })();

    // 제출 시 필수 검증 & 버튼 잠금
    (function(){
        const form = $('#createForm'), btn  = $('#submitBtn');
        if (form) {
            form.addEventListener('submit', (e) => {
                const required = [
                    '#subject-select','#round-select','#unit-select',
                    '#roundProblemNo','#subjectCode','#unitSeqCode','#unitProblemNo',
                    '#title','#answer'
                ];
                for(const sel of required){
                    const el = $(sel);
                    if(!el || !el.value || String(el.value).trim()===''){
                        e.preventDefault();
                        alert('필수 항목을 모두 입력/선택해주세요.');
                        return;
                    }
                }
                // 추가 패턴 체크
                const sc = $('#subjectCode').value, uc = $('#unitSeqCode').value;
                if(!/^\d{2}$/.test(sc) || !/^\d{3}$/.test(uc)){
                    e.preventDefault();
                    alert('과목코드는 2자리, 단원코드는 3자리 숫자로 입력해주세요.');
                    return;
                }
                const rp = parseInt($('#roundProblemNo').value,10);
                const up = parseInt($('#unitProblemNo').value,10);
                if(!(rp>=1 && rp<=40) || !(up>=1 && up<=99)){
                    e.preventDefault();
                    alert('회차 내 번호는 1~40, 단원 내 순번은 1~99 범위여야 합니다.');
                    return;
                }
                btn.disabled = true; btn.textContent = '등록 중…';
            });
        }
    })();
</script>
</body>
</html>
