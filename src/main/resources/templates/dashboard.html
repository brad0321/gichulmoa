<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>ëŒ€ì‹œë³´ë“œ | ê³µì¸ì¤‘ê°œì‚¬ ê¸°ì¶œëª¨ì•„</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>

    <style>
        :root{
            --color-main:#2F4858;   /* Deep Teal Blue */
            --color-sub:#4F7CAC;    /* Smoky Blue */
            --color-point:#F5CD90;  /* Warm Pastel Yellow */
            --text-main:#2C3E3F;    /* Dark Charcoal */
            --text-sub:#7A746E;     /* Warm Gray */
            --bg:#F4F3F1;           /* Warm Light Gray */
            --white:#fff;

            --radius-lg:20px;
            --shadow-sm:0 6px 18px rgba(47,72,88,.10);

            --sidebar-w: 260px;
            --topbar-h: 60px;
        }

        html,body{height:100%}
        body{margin:0; background:var(--bg); color:var(--text-main); font-family:'Noto Sans KR',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;}

        .app{
            display:grid;
            grid-template-columns: var(--sidebar-w) 1fr;
            grid-template-rows: var(--topbar-h) 1fr;
            grid-template-areas: "sidebar topbar" "sidebar main";
            min-height:100vh;
        }

        /* Sidebar */
        .sidebar{ grid-area:sidebar; background:var(--color-main); color:#e7eef3; padding:24px 18px; }
        .sb-title{ font-weight:900; letter-spacing:.6px; font-size:22px; margin-bottom:18px; }
        .sb-nav{ display:flex; flex-direction:column; gap:6px; }
        .sb-link{ display:flex; align-items:center; gap:10px; color:#e7eef3; text-decoration:none; font-weight:700; padding:12px; border-radius:14px; }
        .sb-link:hover{ background:rgba(255,255,255,.08); }
        .sb-link.active{ background:rgba(255,255,255,.14); }
        .sb-link.locked-link{ position:relative; opacity:.75; }
        .sb-link.locked-link::after{ content:"ğŸ”’"; margin-left:6px; font-size:14px; }
        .sb-link.locked-link:hover{ background:rgba(255,255,255,.08); }

        /* Topbar */
        .topbar{ grid-area:topbar; display:flex; align-items:center; justify-content:space-between; padding:0 14px; background:var(--white); box-shadow:var(--shadow-sm); position:sticky; top:0; z-index:5; }
        .brand{ display:flex; align-items:center; gap:10px; }
        .brand img{ height:28px; }
        .brand .title{ font-weight:900; letter-spacing:.2px; }
        .top-right{ display:flex; align-items:center; gap:12px; }
        .hello{ color:var(--text-sub); }
        .pill{ border-radius:999px; padding:6px 10px; font-weight:700; font-size:.85rem; background:#e9eef3; color:var(--color-main); }
        .avatar-link{ display:inline-flex; align-items:center; justify-content:center; width:36px; height:36px; border-radius:50%; background:#e8edf1; text-decoration:none; overflow:hidden; }
        .avatar-img{ width:36px; height:36px; object-fit:cover; border-radius:50%; }

        /* Main */
        .main{ grid-area:main; padding:24px; }
        .wrap{ max-width:1200px; margin:0 auto; }

        /* ì¹´ë“œ ë ˆì´ì•„ì›ƒ */
        .top-grid{ display:grid; grid-template-columns: 1fr; grid-auto-rows: minmax(120px, auto); gap:14px; margin-bottom:16px; }
        .card-count{display:flex; align-items:center; justify-content:space-between; gap:16px; background:#fff; border-radius:20px; box-shadow:var(--shadow-sm); padding:20px 22px; min-height:120px;}
        .dhuge{ display:flex; align-items:baseline; gap:12px; flex-wrap:wrap; }
        .dhuge .label{ background:linear-gradient(135deg,var(--color-main),var(--color-sub)); color:#fff; font-weight:900; border-radius:999px; padding:6px 12px; font-size:1rem; }
        .dhuge .big{ font-weight:900; line-height:1; font-size:clamp(42px, 8vw, 96px); color:var(--color-main); }
        .count-detail{ color:var(--text-sub); font-weight:700; }
        .kpi-row{ display:grid; gap:14px; grid-template-columns: repeat(3,1fr); }
        @media (max-width:900px){ .kpi-row{ grid-template-columns: 1fr 1fr; } }
        @media (max-width:600px){ .kpi-row{ grid-template-columns: 1fr; } }
        .card-kpi{ background:#fff; border-radius:20px; box-shadow:var(--shadow-sm); padding:18px; min-height:88px; display:flex; flex-direction:column; justify-content:center; }
        .kpi-value{ font-size:28px; font-weight:900; margin-bottom:6px; }
        .kpi-label{ color:var(--text-sub); font-weight:700; }

        .bottom-grid{ display:grid; gap:14px; grid-template-columns: 1.2fr 1fr 1fr; grid-auto-rows: minmax(260px, auto); }
        @media (max-width:1100px){ .bottom-grid{ grid-template-columns: 1fr 1fr; } }
        @media (max-width:700px){ .bottom-grid{ grid-template-columns: 1fr; } }
        .cardx{ background:#fff; border-radius:20px; box-shadow:var(--shadow-sm); padding:18px; }
        .card-title{ font-weight:900; margin-bottom:8px; }

        /* ì ê¸ˆ ì˜¤ë²„ë ˆì´ */
        .lockable{ position:relative; }
        .locked-overlay{
            position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
            background:rgba(47,72,88,.22); backdrop-filter: blur(2.5px) saturate(0.7);
            border-radius:20px; z-index:10; cursor:pointer;
        }
        .locked-overlay .badge{
            background:linear-gradient(135deg,var(--color-main),var(--color-sub));
            color:#fff; font-weight:900; border-radius:999px; padding:10px 16px;
            box-shadow:var(--shadow-sm);
        }
        .locked-dim{ filter:grayscale(.6) opacity(.55); pointer-events:none; }
    </style>
</head>
<body>
<div class="app">

    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sb-title">DASHBOARD</div>
        <nav class="sb-nav">
            <a class="sb-link active" th:href="@{/dashboard}">í™ˆ</a>
            <a class="sb-link" th:href="@{/problems/solve}">ê¸°ì¶œë¬¸ì œ í’€ì´</a>
            <a class="sb-link locked-link" href="#" data-bs-toggle="modal" data-bs-target="#loginModal">íšŒì°¨ë³„ ì‹œí—˜</a>
            <a class="sb-link locked-link" href="#" data-bs-toggle="modal" data-bs-target="#loginModal">ì˜¤ë‹µë…¸íŠ¸</a>
            <a class="sb-link locked-link" href="#" data-bs-toggle="modal" data-bs-target="#loginModal">í†µê³„</a>
        </nav>
    </aside>

    <!-- Topbar -->
    <header class="topbar">
        <div class="brand">
            <img src="/img/brandLogo.png" alt="ë¡œê³ ">
            <div class="title">ê³µì¸ì¤‘ê°œì‚¬ ê¸°ì¶œëª¨ì•„</div>
        </div>
        <div class="top-right">
            <span class="hello">ì•ˆë…•í•˜ì„¸ìš”, <strong th:text="${loginUser != null ? loginUser.username : 'ê²ŒìŠ¤íŠ¸'}">ì‚¬ìš©ì</strong>ë‹˜</span>
            <span class="pill">ëŒ€ì‹œë³´ë“œ</span>
            <a class="avatar-link" th:href="@{/members/mypage}">
                <img class="avatar-img" src="/img/profile.png" alt="í”„ë¡œí•„">
            </a>
        </div>
    </header>

    <!-- Main -->
    <main class="main">
        <div class="wrap">
            <section class="top-grid lockable" id="lock-kpi">
                <article class="card-count">
                    <div class="dhuge">
                        <span class="label" id="dBadge">D-00</span>
                        <span class="big" id="dBig">D-00</span>
                    </div>
                    <div class="count-detail" id="countText">00ì¼ 00ì‹œê°„ 00ë¶„ 00ì´ˆ ë‚¨ì•˜ìŠµë‹ˆë‹¤.</div>
                </article>
                <div class="kpi-row">
                    <div class="card-kpi"><div class="kpi-value" th:text="${todaySolved}">null</div><div class="kpi-label">ì˜¤ëŠ˜ í‘¼ ë¬¸ì œ</div></div>
                    <div class="card-kpi"><div class="kpi-value" th:text="${accuracy + '%'}">null%</div><div class="kpi-label">ì •ë‹µë¥ </div></div>
                    <div class="card-kpi"><div class="kpi-value" th:text="${streakDays + 'ì¼'}">nullì¼</div><div class="kpi-label">ì—°ì† ì¶œì„ì¼</div></div>
                </div>
            </section>

            <section class="bottom-grid lockable" id="lock-charts">
                <article class="cardx"><div class="card-title">ì¶œì„ í˜„í™©</div><div id="calDays"></div></article>
                <article class="cardx"><div class="card-title">ê³¼ëª©ë³„ ì •ë‹µë¥ </div><div class="chart-box"><svg id="barChart"></svg></div></article>
                <article class="cardx"><div class="card-title">ì£¼ê°„ í’€ì´ ì¶”ì´</div><div class="chart-box"><svg id="lineChart"></svg></div></article>
            </section>
        </div>
    </main>
</div>

<!-- ë¡œê·¸ì¸ ëª¨ë‹¬ -->
<div class="modal fade" id="loginModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="border-radius: 16px;">
            <div class="modal-header" style="background: var(--color-main); color:#fff;">
                <h5 class="modal-title">ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">íšŒì›ë§Œ ì´ìš©í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤. ë¡œê·¸ì¸ ë˜ëŠ” íšŒì›ê°€ì…ì„ ì§„í–‰í•´ì£¼ì„¸ìš”.</div>
            <div class="modal-footer">
                <a th:href="@{/login}" class="btn btn-primary">ë¡œê·¸ì¸</a>
                <a th:href="@{/signup}" class="btn btn-outline-secondary">íšŒì›ê°€ì…</a>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script th:inline="javascript">
    const IS_GUEST = /*[[${loginUser == null}]]*/ true;
    function attachLock(selector){
        if(!IS_GUEST) return;
        const host = document.querySelector(selector);
        if(!host) return;
        host.classList.add('lockable');
        host.querySelectorAll('.card-count, .card-kpi, .cardx, .chart-box, #calDays')
            .forEach(el=> el.classList.add('locked-dim'));
        const ov = document.createElement('div');
        ov.className = 'locked-overlay';
        ov.innerHTML = `<span class="badge">íšŒì› ì „ìš© Â· ë¡œê·¸ì¸ í•„ìš” ğŸ”’</span>`;
        ov.onclick = ()=> new bootstrap.Modal(document.getElementById('loginModal')).show();
        host.appendChild(ov);
    }
    attachLock('#lock-kpi');
    attachLock('#lock-charts');
</script>
</body>
</html>
